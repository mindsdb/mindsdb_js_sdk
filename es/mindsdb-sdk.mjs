import e from"axios";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,r,n,a,u,o){try{var s=e[u](o),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,a)}function n(e){return function(){var t=this,n=arguments;return new Promise(function(a,u){var o=e.apply(t,n);function s(e){r(o,a,u,s,i,"next",e)}function i(e){r(o,a,u,s,i,"throw",e)}s(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o={url:null,api:null,version:.2},s=function(e){return new p(e)},i=function(e){return new d(e)},c=function(e,t){var r=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=r;var a=e.headers["content-disposition"],u=null;if(a){var o=a.match(/filename="?(.+)"?/);2===o.length&&(u=o[1])}if(!u&&t){var s=t.split("/"),i=s[s.length-1];s=i.split("\\"),u=i=s[s.length-1]}n.setAttribute("download",u=u||"unknown"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)},p=function e(t){var r=this;a(this,e),u(this,"loaded",!1),u(this,"name",""),u(this,"version",""),u(this,"is_active",!1),u(this,"data_source",""),u(this,"predict",null),u(this,"accuracy",0),u(this,"status",""),u(this,"train_end_at",null),u(this,"updated_at",null),u(this,"created_at",null),u(this,"data_preparation",null),u(this,"data_analysis",null),u(this,"model_analysis",null),u(this,"columns",null),u(this,"load",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/predictors/".concat(r.name));case 2:return Object.assign(r,e.sent.data),e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}))),u(this,"loadColumns",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/predictors/".concat(r.name,"/columns"));case 2:return r.columns=e.sent.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}))),u(this,"learn",function(){var e=n(regeneratorRuntime.mark(function e(t){var n,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.fromData,u={to_predict:t.toPredict},(n=t.dataSourceName)?u.data_source_name=n:a&&(u.from_data=a),e.next=5,o.api.put("/predictors/".concat(r.name),u);case 5:return e.abrupt("return",e.sent.data);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"queryPredict",function(){var e=n(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.post("/predictors/".concat(r.name,"/predict"),{when:t});case 2:return e.abrupt("return",e.sent.data);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"delete",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.delete("/predictors/".concat(r.name));case 2:case"end":return e.stop()}},e)}))),u(this,"upload",function(){var e=n(regeneratorRuntime.mark(function e(t,r){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),a={onUploadProgress:function(e){r&&r(Math.round(100*e.loaded/e.total))}},e.next=5,o.api.post("/predictors/upload",n,a);case 5:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),u(this,"download",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/predictors/".concat(r.name,"/download"),{responseType:"blob"});case 2:return c(e.sent),e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}))),u(this,"getDownloadUrl",function(){return"".concat(o.url,"/predictors/").concat(r.name,"/download")}),Object.assign(this,t)},d=function e(t){var r=this;a(this,e),u(this,"loaded",!1),u(this,"source_type","url"),u(this,"name",""),u(this,"source",""),u(this,"missed_files",!1),u(this,"created_at",null),u(this,"updated_at",null),u(this,"row_count",0),u(this,"columns",null),u(this,"data",null),u(this,"missedFileList",null),u(this,"load",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/datasources/".concat(r.name));case 2:return Object.assign(r,e.sent.data),e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}))),u(this,"upload",function(){var e=n(regeneratorRuntime.mark(function e(t,n){var a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.source_type="file",r.source=t.name,(a=new FormData).append("name",r.name),a.append("source_type",r.source_type),a.append("source",r.source),a.append("file",t),u={onUploadProgress:function(e){n&&n(Math.round(100*e.loaded/e.total))}},e.next=10,o.api.put("/datasources/".concat(r.name),a,u);case 10:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),u(this,"uploadFromUrl",function(){var e=n(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.source_type="url",r.source=t,n={name:r.name,source_type:r.source_type,source:r.source},e.next=5,o.api.put("/datasources/".concat(r.name),n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),u(this,"download",n(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.getDownloadUrl(),e.next=3,o.api.get(t,{responseType:"blob"});case 3:return c(e.sent,r.source),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}))),u(this,"getDownloadUrl",function(){return"url"===r.source_type?r.source:"".concat(o.url,"/datasources/").concat(r.name,"/download")}),u(this,"delete",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.delete("/datasources/".concat(r.name));case 2:case"end":return e.stop()}},e)}))),u(this,"loadData",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/datasources/".concat(r.name,"/data"));case 2:return r.data=e.sent.data,e.abrupt("return",r.data);case 5:case"end":return e.stop()}},e)}))),u(this,"loadDataQuality",n(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/predictors/wahtever/analyse_dataset?data_source_name=".concat(r.name));case 2:t=e.sent;try{n=t.data.data_analysis.input_columns_metadata}catch(e){n=null}return r.dataQuality=n,e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}))),u(this,"loadMissedFileList",n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/datasources/".concat(r.name,"/missed_files"));case 2:return r.missedFileList=e.sent.data,e.abrupt("return",r.missedFileList);case 5:case"end":return e.stop()}},e)}))),u(this,"uploadFile",function(){var e=n(regeneratorRuntime.mark(function e(t){var n,a,u,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.column,a=t.rowIndex,u=t.extension,s=t.file,(i=new FormData).append("file",s),i.append("extension",u),e.next=6,o.api.put("/datasources/".concat(r.name,"/files/").concat(n,":").concat(a),i);case 6:return e.abrupt("return",200===e.sent.status);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Object.assign(this,t)};export default{connect:function(t){o.url=t,o.api=e.create({baseURL:t,timeout:2e4})},disconnect:function(){o.url=null,o.token=null,o.api=null},ping:function(){var e=n(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/util/ping");case 2:if(200!==(r=e.sent).status||"object"!==t(r.data)||"ok"!==r.data.status){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),predictors:function(){var e=n(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/predictors/");case 2:return t=(e.sent.data||[]).map(s),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),dataSources:function(){var e=n(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.api.get("/datasources/");case 2:return t=(e.sent.data||[]).map(i),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),DataSource:i,Predictor:s};
